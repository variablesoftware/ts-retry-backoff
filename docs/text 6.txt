// vs-retry-kv.ts
import { withRetry } from '@variablesoftware/retry';
const isKvThrottle = (err: any) => err?.name === 'RateLimitExceededError' || err?.status === 429;

export function kvGet<T>(kv: KVNamespace, key: string, opts?: number) {
  return withRetry(() => kv.get<T>(key, opts), { retryOn: isKvThrottle });
}

export function kvPut(kv: KVNamespace, key: string, val: string) {
  return withRetry(() => kv.put(key, val), { retryOn: isKvThrottle });
}