// vs-retry-fetch.ts
import { withRetry } from '@variablesoftware/retry';
const isFetchError = (err: any) => err instanceof TypeError || err?.status >= 500;

export function fetchWithRetry(input: RequestInfo, init?: RequestInit) {
  return withRetry(() => fetch(input, init).then(r => {
    if (!r.ok) throw Object.assign(new Error(r.statusText), { status: r.status });
    return r;
  }), {
    retryOn: isFetchError,
    maxRetries: 3,
    baseDelayMs: 100,
  });
}